version: '3.7'

networks:
  intranet:
    driver: bridge

services:

  oathkeeper:
    image: oryd/oathkeeper:v0.40
    ports:
      - 4455:4455
      - 4456:4456
    command: serve -c "/etc/config/oathkeeper/oathkeeper.yml"
    environment:
      - LOG_LEVEL=debug
    restart: on-failure
    networks:
      - intranet
    volumes:
      - ./oathkeeper/config:/etc/config/oathkeeper
  
  aad-authservice:
    image: pcibraro/aad-authservice:latest
    ports:
      - 9005:9005
    environment:
      - SERVER_PORT=9005
      - AAD_URL=https://login.microsoftonline.com/f6aba1d9-da41-4ea3-8f30-4970725586a8/oauth2/v2.0
      - AAD_CLIENT_ID=03dcc1f4-d8b7-42df-923e-9f261783f33d
      - AAD_CLIENT_SECRET=fHS8Q~tsW2JVEAg1tOa.dxGIkOf7b1MXFobt4apa
      - OATHKEEPER_URL=http://localhost:4455
    restart: on-failure
    networks:
      - intranet
    

  